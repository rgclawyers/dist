import{b as e}from"./image-url.umd-Bc4HRjOu.js";import"./index-sfE-lb2J.js";const t=/_key\s*==\s*['"](.*)['"]/;function r(e){if(!Array.isArray(e))throw new Error("Path is not an array");return e.reduce(((e,r,n)=>{const o=typeof r;if("number"===o)return`${e}[${r}]`;if("string"===o)return`${e}${0===n?"":"."}${r}`;if(function(e){return"string"==typeof e?t.test(e.trim()):"object"==typeof e&&"_key"in e}(r)&&r._key)return`${e}[_key=="${r._key}"]`;if(Array.isArray(r)){const[t,n]=r;return`${e}[${t}:${n}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(r)}\``)}),"")}const n={"\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","'":"\\'","\\":"\\\\"},o={"\\f":"\f","\\n":"\n","\\r":"\r","\\t":"\t","\\'":"'","\\\\":"\\"};function s(e){const t=[],r=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let n;for(;null!==(n=r.exec(e));)if(void 0===n[1])if(void 0===n[2])if(void 0===n[3]);else{const e=n[3].replace(/\\(\\')/g,(e=>o[e]));t.push({_key:e,_index:-1})}else t.push(parseInt(n[2],10));else{const e=n[1].replace(/\\(\\|f|n|r|t|')/g,(e=>o[e]));t.push(e)}return t}function i(e){return e.map((e=>{if("string"==typeof e||"number"==typeof e)return e;if(""!==e._key)return{_key:e._key};if(-1!==e._index)return e._index;throw new Error(`invalid segment:${JSON.stringify(e)}`)}))}function a(e,t){if(null==t||!t.mappings)return;const r=function(e){return`$${e.map((e=>"string"==typeof e?`['${e.replace(/[\f\n\r\t'\\]/g,(e=>n[e]))}']`:"number"==typeof e?`[${e}]`:""!==e._key?`[?(@._key=='${e._key.replace(/['\\]/g,(e=>n[e]))}')]`:`[${e._index}]`)).join("")}`}(e.map((e=>{if("string"==typeof e||"number"==typeof e)return e;if(-1!==e._index)return e._index;throw new Error(`invalid segment:${JSON.stringify(e)}`)})));if(void 0!==t.mappings[r])return{mapping:t.mappings[r],matchedPath:r,pathSuffix:""};const o=Object.entries(t.mappings).filter((([e])=>r.startsWith(e))).sort((([e],[t])=>t.length-e.length));if(0==o.length)return;const[s,i]=o[0];return{mapping:i,matchedPath:s,pathSuffix:r.substring(s.length)}}function l(e){return"object"==typeof e&&null!==e}function u(e,t,r=[]){return function(e){return null!==e&&Array.isArray(e)}(e)?e.map(((e,n)=>{if(l(e)){const o=e._key;if("string"==typeof o)return u(e,t,r.concat({_key:o,_index:n}))}return u(e,t,r.concat(n))})):l(e)?Object.fromEntries(Object.entries(e).map((([e,n])=>[e,u(n,t,r.concat(e))]))):t(e,r)}function c(e,t,r){return u(e,((e,n)=>{if("string"!=typeof e)return e;const o=a(n,t);if(!o)return e;const{mapping:i,matchedPath:l}=o;if("value"!==i.type||"documentValue"!==i.source.type)return e;const u=t.documents[i.source.document],c=t.paths[i.source.path],p=s(l),f=s(c).concat(n.slice(p.length));return r({sourcePath:f,sourceDocument:u,resultPath:n,value:e})}))}const p="drafts.";function f(e){const{baseUrl:t,workspace:n="default",tool:o="default",id:s,type:a,path:l,projectId:u,dataset:c}=e;if(!t)throw new Error("baseUrl is required");if(!l)throw new Error("path is required");if(!s)throw new Error("id is required");if("/"!==t&&t.endsWith("/"))throw new Error("baseUrl must not end with a slash");const f="default"===n?void 0:n,d="default"===o?void 0:o,h=function(e){return e.startsWith(p)?e.slice(p.length):e}(s),g=Array.isArray(l)?r(i(l)):l,y=new URLSearchParams({baseUrl:t,id:h,type:a,path:g});f&&y.set("workspace",f),d&&y.set("tool",d),u&&y.set("projectId",u),c&&y.set("dataset",c),s.startsWith(p)&&y.set("isDraft","");const m=["/"===t?"":t];f&&m.push(f);const $=["mode=presentation",`id=${h}`,`type=${a}`,`path=${encodeURIComponent(g)}`];return d&&$.push(`tool=${d}`),m.push("intent","edit",`${$.join(";")}?${y}`),m.join("/")}const d=({sourcePath:e,value:t})=>{if(/^\d{4}-\d{2}-\d{2}/.test(r=t)&&Date.parse(r)||function(e){try{new URL(e,e.startsWith("/")?"https://acme.com":void 0)}catch{return!1}return!0}(t))return!1;var r;const n=e.at(-1);return!("slug"===e.at(-2)&&"current"===n||"string"==typeof n&&n.startsWith("_")||"number"==typeof n&&"marks"===e.at(-2)||"href"===n&&"number"==typeof e.at(-2)&&"markDefs"===e.at(-3)||"style"===n||"listItem"===n||e.some((e=>"meta"===e||"metadata"===e||"openGraph"===e||"seo"===e))||"string"==typeof n&&h.has(n))},h=new Set(["color","colour","currency","email","format","gid","hex","href","hsl","hsla","icon","id","index","key","language","layout","link","linkAction","locale","lqip","page","path","ref","rgb","rgba","route","secret","slug","status","tag","template","theme","type","unit","url","username","variant","website"]);function g(r,n,o){var s,i,a,l,u,p,h,g,m;const{filter:$,logger:b,enabled:k}=o;if(!k){const e="config.enabled must be true, don't call this function otherwise";throw null==(s=null==b?void 0:b.error)||s.call(b,`[@sanity/client]: ${e}`,{result:r,resultSourceMap:n,config:o}),new TypeError(e)}if(!n)return null==(i=null==b?void 0:b.error)||i.call(b,"[@sanity/client]: Missing Content Source Map from response body",{result:r,resultSourceMap:n,config:o}),r;if(!o.studioUrl){const e="config.studioUrl must be defined";throw null==(a=null==b?void 0:b.error)||a.call(b,`[@sanity/client]: ${e}`,{result:r,resultSourceMap:n,config:o}),new TypeError(e)}const w={encoded:[],skipped:[]},_=c(r,n,(({sourcePath:t,sourceDocument:r,resultPath:n,value:s})=>{if(!1===("function"==typeof $?$({sourcePath:t,resultPath:n,filterDefault:d,sourceDocument:r,value:s}):d({sourcePath:t,resultPath:n,filterDefault:d,sourceDocument:r,value:s})))return b&&w.skipped.push({path:y(t),value:`${s.slice(0,20)}${s.length>20?"...":""}`,length:s.length}),s;b&&w.encoded.push({path:y(t),value:`${s.slice(0,20)}${s.length>20?"...":""}`,length:s.length});const{baseUrl:i,workspace:a,tool:l}=function(e){let t="string"==typeof e?e:e.baseUrl;return"/"!==t&&(t=t.replace(/\/$/,"")),"string"==typeof e?{baseUrl:t}:{...e,baseUrl:t}}("function"==typeof o.studioUrl?o.studioUrl(r):o.studioUrl);if(!i)return s;const{_id:u,_type:c,_projectId:p,_dataset:h}=r;return e(s,{origin:"sanity.io",href:f({baseUrl:i,workspace:a,tool:l,id:u,type:c,path:t,...!o.omitCrossDatasetReferenceData&&{dataset:h,projectId:p}})},!1)}));if(b){const e=w.skipped.length,r=w.encoded.length;if((e||r)&&(null==(l=(null==b?void 0:b.groupCollapsed)||b.log)||l("[@sanity/client]: Encoding source map into result"),null==(u=b.log)||u.call(b,`[@sanity/client]: Paths encoded: ${w.encoded.length}, skipped: ${w.skipped.length}`)),w.encoded.length>0&&(null==(p=null==b?void 0:b.log)||p.call(b,"[@sanity/client]: Table of encoded paths"),null==(h=(null==b?void 0:b.table)||b.log)||h(w.encoded)),w.skipped.length>0){const e=new Set;for(const{path:r}of w.skipped)e.add(r.replace(t,"0").replace(/\[\d+\]/g,"[]"));null==(g=null==b?void 0:b.log)||g.call(b,"[@sanity/client]: List of skipped paths",[...e.values()])}(e||r)&&(null==(m=null==b?void 0:b.groupEnd)||m.call(b))}return _}function y(e){return r(i(e))}var m=Object.freeze({__proto__:null,stegaEncodeSourceMap:g});export{m as a,c as e,g as s};
